<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="" >

<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
      <meta name="dcterms.date" content="2023-02-26" />
        <title>博客迁移从域名到部署</title>
    <link rel="stylesheet" href="/resources/css/article/theme.css" />
    <link rel="stylesheet" href="/resources/css/article/code.css" />
      
  
<style>
@font-face {
  font-family: CONTENT;
  src: url('/resources/fonts/subsets/FT3dcffc06-560d-4ab2-9c64-62cf2b24682a.woff2') format('woff2'),
       url('/resources/fonts/subsets/FT3dcffc06-560d-4ab2-9c64-62cf2b24682a.ttf') format('truetype');
}
</style>
  

  <script src="/resources/js/article.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.css" />
</head>

<body>
  <progress id="content_progress" value="0"></progress>

  
  <header>
    <h1 class="title">博客迁移从域名到部署</h1>
    <!-- Subtitle -->
        <h3 class="subtitle">&nbsp;</h3>
      </header>

    <nav id="TOC" role="doc-toc">
    <strong>文章归类:&nbsp;<a href="/pages/category.html#杂项">杂项</a> </strong>
    <input type="checkbox" id="contents">
    <ul>
    <li><a href="#域名的选择和购买" id="toc-域名的选择和购买">域名的选择和购买</a></li>
    <li><a href="#render" id="toc-render">Render</a></li>
    <li><a href="#cloudflare" id="toc-cloudflare">Cloudflare</a></li>
    </ul>
    <ul>
      <li><a href="#reference">参考链接</a></li>
      <li>&nbsp;</li>
      <li class="tools">
        <span id="backtomain">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house"
            viewBox="0 0 16 16">
            <path
              d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z" />
          </svg>
        </span>
        <span id="larger">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z" />
          </svg>
        </span>
        <span id="smaller">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dash-lg"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M2 8a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11A.5.5 0 0 1 2 8Z" />
          </svg>
        </span>
        <span id="switchfont">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-fonts"
            viewBox="0 0 16 16">
            <path
              d="M12.258 3h-8.51l-.083 2.46h.479c.26-1.544.758-1.783 2.693-1.845l.424-.013v7.827c0 .663-.144.82-1.3.923v.52h4.082v-.52c-1.162-.103-1.306-.26-1.306-.923V3.602l.431.013c1.934.062 2.434.301 2.693 1.846h.479L12.258 3z" />
          </svg>
        </span>
        <span id="backtotop">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-bar-up"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M8 10a.5.5 0 0 0 .5-.5V3.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 3.707V9.5a.5.5 0 0 0 .5.5zm-7 2.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1-.5-.5z" />
          </svg>
        </span>
      </li>
    </ul>

  </nav>
  
  <main>
    <p>本站进行了一次迁徙，其实也不能说是完全的「迁徙」，但不管怎么样，现在可以使用自己的域名，而不是托管使用 github.io 的子域名了。除此以外，部署方式也作了修改，不再使用中国境内访问慢吞吞的 Github Pages 而采用 render.com 提供的部署服务，同时也套上了 Cloudflare。总之，除了域名费用以外并没有花其他的钱。这篇文章记录一下整个的流程。</p>
    <h1 id="域名的选择和购买">域名的选择和购买</h1>
    <p><strong>购买域名的第一注意事项：不要使用中国的域名注册商家或者购买由中国的公司/组织管理的顶级域名</strong>。这样做纯粹是为了避免麻烦，主要是不可预期的政策风险和及其复杂的备案流程。即使你像我一样只是一个遵纪守法的好公民，这一整套流程下来，钱和精力都要耗费不少。具体的来讲，首先不要购买 <code>.cn</code> 的域名，其次不要选择中文域名，最后，在其他域名之间选择时，记得先去 <a href="https://icannwiki.org/">ICANN Wiki</a> 查询一下你要购买的顶级域名的管理者到底是何方神圣，省得后悔。比如，本站的新域名的顶级域名 <a href="https://icannwiki.org/Top_Registry"><code>.top</code></a> 就是一家江苏省的公司管理的，这也是我购买以后才发现，真是后悔不迭。</p>
    <p>其次，要注意「第一年价格」和「续费价格」，有的域名第一年很便宜，但之后续费就飙升到几十乃至上百美元，另外还需要注意各种附加服务，提防不小心选择到自己不需要的东西。</p>
    <p>我选择的域名注册商家是 <a href="http://namesilo.com">Namesilo</a>，主要原因是它支持支付宝支付。选择和购买很简单顺畅，毕竟没有一个商家会在用户付款的路上添堵。然而，相比于它现代的选择购买界面：</p>
    <p><img src="./assets/main.png" /></p>
    <p>它的后台管理界面似乎让你回到了 15 年前：</p>
    <p><img src="./assets/bad.png" /></p>
    <p>以至于我第一次进入时以为自己被什么野鸡商家骗了钱（</p>
    <p>接下来在右边第二个「Domain Manager」里面确认你的域名即可。</p>
    <p><img src="./assets/div.png" /></p>
    <h1 id="render">Render</h1>
    <p>Github Pages 其实已经很好了，但是由于众所周知的原因，中国境内访问它时不时会被阻断和劣化。所以需要另外一个部署服务来「加速」。有不少教程推荐使用 Netlify，但是它很荣幸的在我所在的区域被 reset 了。所以我选择其他替代方案。</p>
    <p>其实这些服务，Netlify 也好，Render 也好，对于我这样的用户来讲都是大同小异的。我用不到复杂的功能，只是作为一个静态站点同步和部署来用。</p>
    <p>直接在<a href="https://dashboard.render.com/register">这里</a>注册登录，如果使用 Github 登录，可以直接快捷的绑定 repo。选择创建一个新的 Static Site，然后点击右侧的 「Configure account 」绑定 Github 帐号里面的相应 repo 点击 Connect 即可。</p>
    <p><img src="./assets/start.png" /></p>
    <p>然后就是配置。你需要起一个名字，它同样是一个二级域名：<code>*.onrender.com</code>。不过既然接下来要自定义域名这个也无关紧要。我的站点是完全本地生成后 push 到仓库的，所以没有 Build Command，Publish directory 则是根目录 <code>./</code>。<strong>默认情况下每一次对源 repo 的 push 都会触发一次更新</strong>，不需要手动设置。</p>
    <p><img src="./assets/cfgs.png" /></p>
    <p>接下来是等待部署。等到部署完成后，就可以访问了。同时，状态变成这样：</p>
    <p><img src="./assets/oks.png" /></p>
    <p>此时可以访问 <code>name.onrender.com</code> 访问了。这种情况下它相当于是一个类似 Github Pages 但是略微加速。</p>
    <h1 id="cloudflare">Cloudflare</h1>
    <p>使用它不仅仅是出于防止 DDOS 或者的考虑，<del>毕竟 CDN 能减速。</del>其实这反而是次要的考虑。要使用 Cloudflare ，首先需要把域名的 nameserver 转移到 Cloudflare 那边去。Cloudflare 注册以后会有一个向导，一步一步来就行了。主要是 namesilo 那边。你需要先勾选复选框，再点击：</p>
    <p><img src="./assets/div2.png" /></p>
    <p>然后把原来的删除，添加 Cloudflare 给你的：</p>
    <p><img src="./assets/ns.png" /></p>
    <p>接下来是 CF 这边，DNS 缓存的全球更新需要一点时间，所以需要等一会儿。接下来就是设置解析地址，点到你的域名，DNS 设置里面添加。DNS 记录可以理解成一个 K-V 对，主要需要知道的三种记录类型：</p>
    <ul>
    <li>A : 域名 -&gt; IPv4 地址</li>
    <li>AAAA : 域名 -&gt; IPv6 地址</li>
    <li>CNAME : 域名 -&gt; 另外一个域名</li>
    </ul>
    <p>添加好相应的域名即可。注意在导入站点的时候，会发现有几条不认识的 A 记录，那是 Namesilo 的广告页面，删掉就行。添加 <code>A</code> 记录可以使用中国境内的 VPS 地址也可以正常访问，但是<strong>有合规性风险</strong>，不建议尝试。「要么全是(中国)境外，要么全是(中国)境内」，不要混着来。</p>
    <p><img src="./assets/name.png" /></p>
    <p>所以，访问 <code>blog.izfsk.top</code> 就会相应的跳转到 <code>izfsk.onrender.com</code> 那边去。但是，此时还是不能够正常使用，因为 Render 那边的 <code>Custom Domains</code> 还没有设置。回到 Render 的 Dashboard 里面找到你的项目，在 Settings 里面，添加自定义的域名即可。需要等待一会儿 DNS 刷新以及 Render 处理证书。最后的状态是这样的：</p>
    <p><img src="./assets/ok.png" /></p>
    <p>那么就大功告成啦！</p>
    <p>其实 Render 还支持免费(有大小和时间限制的) PostgreSQL 服务和 Web Service 服务，完全可以折腾一下搞一个评论功能，把白嫖进行到底（</p>

    <br />
    <!--%%REF%%-->


    <br/>
    <div data-chirpy-comment="true"></div>
  </main>



  <footer>
    <p class="signoff">
    <div class="metadata">
            <p class="date"><time datetime="2023-02-26">创建日期：2023-02-26</time></p>
            <p class="lastmodify"><time>最后编译：2023-07-14</time></p>
    </div>
    </p>
  </footer>

  </body>

</html>