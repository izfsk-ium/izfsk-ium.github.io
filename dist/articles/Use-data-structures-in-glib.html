<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="" >

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="keywords" content='blog, izfsk-ium, izfsk, 博客'>

  <meta name=author content=izfsk>
  <meta property=og:site_name content="白漠流霜">
  <meta name="twitter:title" content="使用 glib 中的数据结构">
  <meta property=og:title content="使用 glib 中的数据结构">
  <meta itemprop=name content="使用 glib 中的数据结构">
  <meta name="keywords" content='blog, izfsk-ium, izfsk, 博客'>
  <meta property='og:type' content='website'>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="izfsk" />

    <meta name="dcterms.date" content="2023-09-05" />
        <title>使用 glib 中的数据结构</title>
    <link rel="stylesheet" href="/resources/css/article/theme.css" />
    <link rel="stylesheet" href="/resources/css/article/code.css" />
      
  
<style>
@font-face {
  font-family: CONTENT;
  src: url('/resources/fonts/subsets/FTbce81e33-c008-4b15-8059-b5052cf00897.woff2') format('woff2'),
       url('/resources/fonts/subsets/FTbce81e33-c008-4b15-8059-b5052cf00897.ttf') format('truetype');
}
</style>


  <script src="/resources/js/article.min.js"></script>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.css" />
</head>

<body>
  <progress id="content_progress" value="0"></progress>

  
  <header>
    <small style="display: none !important;" id="article-uuid">bce81e33-c008-4b15-8059-b5052cf00897</small>
    <h1 class="title">使用 glib 中的数据结构</h1>
    <!-- Subtitle -->
        <h3 class="subtitle">&nbsp;</h3>
      </header>

    <nav id="TOC" role="doc-toc">
    <li class="tools">
      <span id="togglesidebar">
        <b>隐藏</b>
      </span>
      <span id="readingmode">
        <b>列印</b>
      </span>
      <span id="switchfont">
        <b>字体</b>
      </span>
      <span id="backtotop">
        <b>页顶</b>
      </span>
    </li>
    <strong>文章归类:&nbsp;<a href="/pages/category.html#备忘">备忘</a> </strong>
    <input type="checkbox" id="contents">
    <ul>
    <li><a href="#单链表" id="toc-单链表">单链表</a></li>
    <li><a href="#双向链表" id="toc-双向链表">双向链表</a></li>
    <li><a href="#散列表" id="toc-散列表">散列表</a></li>
    <li><a href="#数组" id="toc-数组">数组</a></li>
    <li><a href="#树" id="toc-树">树</a></li>
    </ul>
    <ul>
      <li><a href="#reference">参考链接</a></li>
    </ul>

  </nav>
  
  <main>
    

    <p>程序有两大构成要素，数据结构和算法，而在这两大要素中，因为数据结构是实现算法的基础，所以对各种常见数据结构的实现，在这两者中，优先性是第一位的。如果能在实现数据结构的过程中，开发出高可复用的类库，也能使开发者无比愉快，而在现实生活中，存在着对于这种类库的开发精益求精的项目，我们通常把这种类库称为标准库。对于 C 语言，这种类库不少，而 glib 是尤其突出常用的一种。</p>
    <p>对于使用 <code>glib</code> 的程序，使用 <code>pkg-config</code> 编译：</p>
    <div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cc</span> <span class="at">-Wall</span> <span class="kw">`</span><span class="ex">pkg-config</span> <span class="at">--cflags</span> glib-2.0<span class="kw">`</span> demo.c <span class="kw">`</span><span class="ex">pkg-config</span> <span class="at">--libs</span> glib-2.0<span class="kw">`</span></span></code></pre></div>
    <h2 id="单链表">单链表</h2>
    <p>glib 中最基础的数据结构是单向链表 <code>GSList</code>，对于单向链表，只能够从一个方向遍历。每次向其中添加一个新的项目，就创建一个新的 <code>GSList struct</code> 保存数据项和指向下一个内容的指针。以下是基本举例：</p>
    <div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glib.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 创建一个新的链表 */</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  GSList <span class="op">*</span>list <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 添加新的项目， 注意将新的节点赋值给原来的*/</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  list <span class="op">=</span> g_slist_append<span class="op">(</span>list<span class="op">,</span> <span class="st">&quot;Hello!&quot;</span><span class="op">);</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  list <span class="op">=</span> g_slist_append<span class="op">(</span>list<span class="op">,</span> <span class="st">&quot;world&quot;</span><span class="op">);</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  list <span class="op">=</span> g_slist_append<span class="op">(</span>list<span class="op">,</span> <span class="st">&quot;second&quot;</span><span class="op">);</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  list <span class="op">=</span> g_slist_append<span class="op">(</span>list<span class="op">,</span> <span class="st">&quot;second&quot;</span><span class="op">);</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* prepend 比 append 快速， 后者需要遍历整个链表 */</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  list <span class="op">=</span> g_slist_prepend<span class="op">(</span>list<span class="op">,</span> <span class="st">&quot;apple&quot;</span><span class="op">);</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  list <span class="op">=</span> g_slist_prepend<span class="op">(</span>list<span class="op">,</span> <span class="st">&quot;pie&quot;</span><span class="op">);</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 获取长度 */</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;Length of list : </span><span class="sc">%d</span><span class="st">.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> g_slist_length<span class="op">(</span>list<span class="op">));</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 删除项目 */</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  list <span class="op">=</span> g_slist_remove<span class="op">(</span>list<span class="op">,</span> <span class="st">&quot;apple&quot;</span><span class="op">);</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  list <span class="op">=</span> g_slist_remove_all<span class="op">(</span>list<span class="op">,</span> <span class="st">&quot;second&quot;</span><span class="op">);</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;After remove, length of list : </span><span class="sc">%d</span><span class="st">.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> g_slist_length<span class="op">(</span>list<span class="op">));</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 获取最后一个，第 n 个项目 */</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  GSList <span class="op">*</span>last_element <span class="op">=</span> g_slist_last<span class="op">(</span>list<span class="op">);</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  GSList <span class="op">*</span>second_element <span class="op">=</span> g_slist_nth<span class="op">(</span>list<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  gpointer third_element <span class="op">=</span> g_slist_nth_data<span class="op">(</span>list<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;Last element : </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> last_element<span class="op">-&gt;</span>data<span class="op">);</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;Second element : </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> second_element<span class="op">-&gt;</span>data<span class="op">);</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;Third element : </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> third_element<span class="op">);</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  g_slist_free<span class="op">(</span>list<span class="op">);</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p><code>GSList</code> 对于用户自定义的类型也可以使用。</p>
    <div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glib.h&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">unsigned</span> <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  gboolean is_male<span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Person<span class="op">;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  GSList <span class="op">*</span>list <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 使用 malloc 进行内存管理 */</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  Person <span class="op">*</span>person_1 <span class="op">=</span> <span class="op">(</span>Person <span class="op">*)</span>malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Person<span class="op">));</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">(</span>person_1 <span class="op">!=</span> NULL<span class="op">);</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  person_1<span class="op">-&gt;</span>id <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  person_1<span class="op">-&gt;</span>is_male <span class="op">=</span> TRUE<span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  person_1<span class="op">-&gt;</span>name <span class="op">=</span> <span class="st">&quot;John&quot;</span><span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  list <span class="op">=</span> g_slist_append<span class="op">(</span>list<span class="op">,</span> person_1<span class="op">);</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 使用 g_new 进行内存管理 */</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  Person <span class="op">*</span>person_2 <span class="op">=</span> g_new<span class="op">(</span>Person<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">(</span>person_2 <span class="op">!=</span> NULL<span class="op">);</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  person_2<span class="op">-&gt;</span>id <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  person_2<span class="op">-&gt;</span>is_male <span class="op">=</span> FALSE<span class="op">;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  person_2<span class="op">-&gt;</span>name <span class="op">=</span> <span class="st">&quot;Alice&quot;</span><span class="op">;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  list <span class="op">=</span> g_slist_append<span class="op">(</span>list<span class="op">,</span> person_2<span class="op">);</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">(</span>g_slist_length<span class="op">(</span>list<span class="op">)</span> <span class="op">==</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">(((</span>Person <span class="op">*)(</span>g_slist_nth_data<span class="op">(</span>list<span class="op">,</span> <span class="dv">1</span><span class="op">)))-&gt;</span>is_male <span class="op">==</span> FALSE<span class="op">);</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">(((</span>Person <span class="op">*)(</span>g_slist_nth_data<span class="op">(</span>list<span class="op">,</span> <span class="dv">1</span><span class="op">)))-&gt;</span>id <span class="op">==</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 内存释放 */</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  free<span class="op">(</span>person_1<span class="op">);</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  g_free<span class="op">(</span>person_2<span class="op">);</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  g_slist_free<span class="op">(</span>list<span class="op">);</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>要遍历整个链表，有两个方法：使用 <code>for</code> 循环，或者使用回调函数。</p>
    <div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glib.h&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">static</span> <span class="dt">void</span> callback<span class="op">(</span>gpointer item<span class="op">,</span> gpointer addition_data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> addition_data<span class="op">,</span> item<span class="op">);</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  GSList <span class="op">*</span>list_1 <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  GSList <span class="op">*</span>list_2 <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    list_1 <span class="op">=</span> g_slist_append<span class="op">(</span>list_1<span class="op">,</span> GINT_TO_POINTER<span class="op">(</span>i<span class="op">));</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    list_2 <span class="op">=</span> g_slist_prepend<span class="op">(</span>list_2<span class="op">,</span> GINT_TO_POINTER<span class="op">(-</span>i<span class="op">));</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 使用 for 迭代 */</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>GSList <span class="op">*</span>ptr <span class="op">=</span> list_1<span class="op">;</span> ptr<span class="op">;</span> ptr <span class="op">=</span> ptr<span class="op">-&gt;</span>next<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;list_1 : </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> ptr<span class="op">-&gt;</span>data<span class="op">);</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 使用回调 */</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  g_slist_foreach<span class="op">(</span>list_2<span class="op">,</span> <span class="op">(</span>GFunc<span class="op">)</span>callback<span class="op">,</span> <span class="st">&quot;list_2 :&quot;</span><span class="op">);</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p><code>GList</code> 也提供列表合并，排序，倒序，寻找等常见功能（以上面的 <code>list_1</code> 和 <code>list_2</code> 为例）：</p>
    <div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">static</span> gint comper<span class="op">(</span>gconstpointer item1<span class="op">,</span> gconstpointer item2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> item1 <span class="op">&gt;=</span> item2<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">static</span> gint finder<span class="op">(</span>gconstpointer item<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> item <span class="op">==</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 列表合并 */</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  GSList <span class="op">*</span>concated <span class="op">=</span> g_slist_concat<span class="op">(</span>list_1<span class="op">,</span> list_2<span class="op">);</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">(</span>g_slist_length<span class="op">(</span>concated<span class="op">)</span> <span class="op">==</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 列表翻转 */</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  GSList <span class="op">*</span>reversed <span class="op">=</span> g_slist_reverse<span class="op">(</span>list_1<span class="op">);</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">(</span>g_slist_nth<span class="op">(</span>list_1<span class="op">,</span> <span class="dv">0</span><span class="op">)-&gt;</span>data <span class="op">==</span> g_slist_last<span class="op">(</span>reversed<span class="op">)-&gt;</span>data<span class="op">);</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 排序 */</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  GSList <span class="op">*</span>sorted <span class="op">=</span> g_slist_sort<span class="op">(</span>list_1<span class="op">,</span> <span class="op">(</span>GCompareFunc<span class="op">)</span>comper<span class="op">);</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 寻找 */</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  GSList <span class="op">*</span>result <span class="op">=</span> g_slist_find<span class="op">(</span>concated<span class="op">,</span> GINT_TO_POINTER<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">(</span>result <span class="op">!=</span> NULL<span class="op">);</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  result <span class="op">=</span> g_slist_find_custom<span class="op">(</span>concated<span class="op">,</span> NULL<span class="op">,</span> <span class="op">(</span>GCompareFunc<span class="op">)(</span>finder<span class="op">));</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">(</span>result <span class="op">!=</span> NULL<span class="op">);</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  result <span class="op">=</span> g_slist_find<span class="op">(</span>concated<span class="op">,</span> GINT_TO_POINTER<span class="op">(</span><span class="dv">114514</span><span class="op">));</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  assert<span class="op">(</span>result <span class="op">==</span> NULL<span class="op">);</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span></code></pre></div>
    <h2 id="双向链表">双向链表</h2>
    <p>双向链表和单向链表类似，但是保存一个额外的指针指向上一个节点，因此可以实现双向查找使用。glib 中实现的双向链表名为 <code>GList</code>，大多数 <code>GSList</code> 可以使用的 API <code>GList</code> 都有类似的 API。以下是 <code>GList</code> 受益于前项指针所特有的操作：</p>
    <div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glib.h&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  GList <span class="op">*</span>list <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    list <span class="op">=</span> g_list_append<span class="op">(</span>list<span class="op">,</span> GINT_TO_POINTER<span class="op">(</span>i<span class="op">));</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  GList <span class="op">*</span>last <span class="op">=</span> g_list_last<span class="op">(</span>list<span class="op">);</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  GList <span class="op">*</span>first <span class="op">=</span> g_list_first<span class="op">(</span>list<span class="op">);</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  GList <span class="op">*</span>last_prev <span class="op">=</span> g_list_previous<span class="op">(</span>last<span class="op">);</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  GList <span class="op">*</span>last_prev_prev <span class="op">=</span> g_list_nth_prev<span class="op">(</span>last<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  g_assert<span class="op">(</span>last<span class="op">-&gt;</span>data <span class="op">==</span> GINT_TO_POINTER<span class="op">(</span><span class="dv">99</span><span class="op">));</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  g_assert<span class="op">(</span>first<span class="op">-&gt;</span>data <span class="op">==</span> GINT_TO_POINTER<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  g_assert<span class="op">(</span>last_prev<span class="op">-&gt;</span>data <span class="op">==</span> GINT_TO_POINTER<span class="op">(</span><span class="dv">98</span><span class="op">));</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  g_assert<span class="op">(</span>last_prev_prev<span class="op">-&gt;</span>data <span class="op">==</span> GINT_TO_POINTER<span class="op">(</span><span class="dv">97</span><span class="op">));</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  g_list_free<span class="op">(</span>list<span class="op">);</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>要寻找某个元素的位置，使用 <code>g_list_index</code> 和 <code>g_list_position</code>:</p>
    <div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>gint index <span class="op">=</span> g_list_index<span class="op">(</span>list<span class="op">,</span> GINT_TO_POINTER<span class="op">(</span><span class="dv">25</span><span class="op">));</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>gint index_2 <span class="op">=</span> g_list_position<span class="op">(</span>list<span class="op">,</span> g_list_last<span class="op">(</span>list<span class="op">));</span></span></code></pre></div>
    <h2 id="散列表">散列表</h2>
    <p>散列表使用散列函数来定位键，因此能快速执行操作。散列函数接收一个键，并为该键计算一个唯一值，称为散列。在 glib 中的散列表是 <code>GHashTable</code>。</p>
    <p>创建散列表的函数是</p>
    <div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>GHashTable<span class="op">*</span> g_hash_table_new<span class="op">(</span>GHashFunc hash_func<span class="op">,</span> GEqualFunc key_equal_func<span class="op">);</span></span></code></pre></div>
    <p>要使用 <code>GHashTable</code>，需要提供一个 <code>GHashFunc</code> 和 <code>GEqualFunc</code>。两者的定义分别是</p>
    <p><code>typedef guint (*GHashFunc) (gconstpointer key);</code></p>
    <p><code>typedef gboolean (*GEqualFunc)(gconstpointer a, gconstpointer b);</code></p>
    <p>前者对每个元素生成唯一的 Hash，后者比较两者的值。对于简单的 <code>String - String</code> 散列表，可以使用预定义的函数：</p>
    <div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glib.h&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* g_str_hash 函数实现 &quot;djb &quot;哈希算法 */</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  GHashTable <span class="op">*</span>hash <span class="op">=</span> g_hash_table_new<span class="op">(</span>g_str_hash<span class="op">,</span> g_str_equal<span class="op">);</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  g_hash_table_insert<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;Virginia&quot;</span><span class="op">,</span> <span class="st">&quot;Richmond&quot;</span><span class="op">);</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  g_hash_table_insert<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;Texas&quot;</span><span class="op">,</span> <span class="st">&quot;Austin&quot;</span><span class="op">);</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  g_hash_table_insert<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;Ohio&quot;</span><span class="op">,</span> <span class="st">&quot;Columbus&quot;</span><span class="op">);</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>除此以外， glib 还有对于其他常见类型的 hash 函数。<strong>注意：Hash 函数是针对 key 的，而不是对 value 的。</strong></p>
    <figure>
    <img src="./assets/avilable_hashs.png" alt="其他常见类型的 hash 函数" />
    <figcaption aria-hidden="true">其他常见类型的 hash 函数</figcaption>
    </figure>
    <p>对于哈希表的增删查改很容易完成：</p>
    <div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  GHashTable <span class="op">*</span>hash <span class="op">=</span> g_hash_table_new<span class="op">(</span>g_str_hash<span class="op">,</span> g_str_equal<span class="op">);</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 增 */</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  g_hash_table_insert<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;A&quot;</span><span class="op">,</span> <span class="st">&quot;Aa&quot;</span><span class="op">);</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  g_hash_table_insert<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;B&quot;</span><span class="op">,</span> <span class="st">&quot;Bb&quot;</span><span class="op">);</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  g_hash_table_insert<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;C&quot;</span><span class="op">,</span> <span class="st">&quot;Cc&quot;</span><span class="op">);</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;There are </span><span class="sc">%d</span><span class="st"> keys in the hash</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> g_hash_table_size<span class="op">(</span>hash<span class="op">));</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 删 */</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  gboolean found <span class="op">=</span> g_hash_table_remove<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;C&quot;</span><span class="op">);</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 查 */</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span>g_hash_table_lookup<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;B&quot;</span><span class="op">));</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 改 */</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  g_hash_table_replace<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;A&quot;</span><span class="op">,</span> <span class="st">&quot;AAA&quot;</span><span class="op">);</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  g_hash_table_destroy<span class="op">(</span>hash<span class="op">);</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>Key-Value 遍历和查找：</p>
    <div class="sourceCode" id="cb11"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glib.h&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">static</span> <span class="dt">void</span> iterator<span class="op">(</span>gpointer key<span class="op">,</span> gpointer value<span class="op">,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                            gpointer addition_data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span>addition_data<span class="op">,</span> key<span class="op">,</span> value<span class="op">);</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  GHashTable <span class="op">*</span>hash <span class="op">=</span> g_hash_table_new<span class="op">(</span>g_str_hash<span class="op">,</span> g_str_equal<span class="op">);</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  g_hash_table_insert<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;A&quot;</span><span class="op">,</span> <span class="st">&quot;Aa&quot;</span><span class="op">);</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  g_hash_table_insert<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;B&quot;</span><span class="op">,</span> <span class="st">&quot;Bb&quot;</span><span class="op">);</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  g_hash_table_insert<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;C&quot;</span><span class="op">,</span> <span class="st">&quot;Cc&quot;</span><span class="op">);</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  g_hash_table_foreach<span class="op">(</span>hash<span class="op">,</span> <span class="op">(</span>GHFunc<span class="op">)</span>iterator<span class="op">,</span> <span class="st">&quot;</span><span class="sc">%s</span><span class="st"> -&gt; </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  g_hash_table_destroy<span class="op">(</span>hash<span class="op">);</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>除了 <code>g_hash_table_new</code> 以外，还有一个 <code>g_hash_table_new_full</code>，其签名如下：</p>
    <div class="sourceCode" id="cb12"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>GHashTable <span class="op">*</span>g_hash_table_new_full<span class="op">(</span>GHashFunc hash_func<span class="op">,</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                  GEqualFunc key_equal_func<span class="op">,</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                                  GDestroyNotify key_destroy_func<span class="op">,</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                  GDestroyNotify value_destroy_func<span class="op">);</span></span></code></pre></div>
    <p>其中 <code>key_destroy_func</code> 和 <code>value_destroy_func</code> 分别在 key 和 value 摧毁时调用。</p>
    <div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glib.h&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> key_destroyed<span class="op">(</span>gpointer data<span class="op">)</span> <span class="op">{</span> printf<span class="op">(</span><span class="st">&quot;key </span><span class="sc">%s</span><span class="st"> destroyed.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> data<span class="op">);</span> <span class="op">}</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> value_destroyed<span class="op">(</span>gpointer data<span class="op">)</span> <span class="op">{</span> printf<span class="op">(</span><span class="st">&quot;value </span><span class="sc">%s</span><span class="st"> destoryed</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> data<span class="op">);</span> <span class="op">}</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  GHashTable <span class="op">*</span>hash <span class="op">=</span> g_hash_table_new_full<span class="op">(</span>g_str_hash<span class="op">,</span> g_str_equal<span class="op">,</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                                           <span class="op">(</span>GDestroyNotify<span class="op">)</span>key_destroyed<span class="op">,</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                                           <span class="op">(</span>GDestroyNotify<span class="op">)</span>value_destroyed<span class="op">);</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  g_hash_table_insert<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;A&quot;</span><span class="op">,</span> <span class="st">&quot;AA&quot;</span><span class="op">);</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  g_hash_table_insert<span class="op">(</span>hash<span class="op">,</span> <span class="st">&quot;B&quot;</span><span class="op">,</span> <span class="st">&quot;BB&quot;</span><span class="op">);</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  g_hash_table_destroy<span class="op">(</span>hash<span class="op">);</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>运行后将会显示：</p>
    <div class="sourceCode" id="cb14"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>key B destroyed<span class="op">.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">value</span> BB destoryed</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>key A destroyed<span class="op">.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">value</span> AA destoryed</span></code></pre></div>
    <h2 id="数组">数组</h2>
    <p>除了链表，glib 还提供了另外一种顺序容器 <code>GArray</code> 来容纳指定类型的数据。相比于链表，<code>GArray</code> 拥有更快的访问速度。<code>GArray</code> 的初始化函数为:</p>
    <p><code>GArray *g_array_new(gboolean zero_terminated, gboolean clear_, guint element_size)</code></p>
    <p>其中，第一个参数是整个数组的内容是否为 ‘0’ 结尾，第二个参数是每个元素是否初始化为 ‘0’。</p>
    <div class="sourceCode" id="cb15"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glib.h&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PRINT_ARRAY_CONTENTS                                                   </span><span class="op">\</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="pp">  </span><span class="cf">for</span><span class="pp"> </span><span class="op">(</span><span class="dt">int</span><span class="pp"> i </span><span class="op">=</span><span class="pp"> </span><span class="dv">0</span><span class="op">;</span><span class="pp"> i </span><span class="op">&lt;</span><span class="pp"> array</span><span class="op">-&gt;</span><span class="pp">len</span><span class="op">;</span><span class="pp"> i</span><span class="op">++)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                       </span><span class="op">\</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="pp">    printf</span><span class="op">(</span><span class="st">&quot; [</span><span class="sc">%d</span><span class="st">] : </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span><span class="pp"> i</span><span class="op">,</span><span class="pp"> g_array_index</span><span class="op">(</span><span class="pp">array</span><span class="op">,</span><span class="pp"> </span><span class="dt">char</span><span class="pp"> </span><span class="op">*,</span><span class="pp"> i</span><span class="op">));</span><span class="pp">                </span><span class="op">\</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="pp">  </span><span class="op">}</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  GArray <span class="op">*</span>array <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  array <span class="op">=</span> g_array_new<span class="op">(</span>FALSE<span class="op">,</span> FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">char</span> <span class="op">*));</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 增加内容 */</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> <span class="op">*</span>first <span class="op">=</span> <span class="st">&quot;hello&quot;</span><span class="op">,</span> <span class="op">*</span>second <span class="op">=</span> <span class="st">&quot;there&quot;</span><span class="op">,</span> <span class="op">*</span>third <span class="op">=</span> <span class="st">&quot;world&quot;</span><span class="op">,</span> <span class="op">*</span>forth <span class="op">=</span> <span class="st">&quot;forth&quot;</span><span class="op">;</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  g_array_append_val<span class="op">(</span>array<span class="op">,</span> first<span class="op">);</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  g_array_append_val<span class="op">(</span>array<span class="op">,</span> second<span class="op">);</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  g_array_append_val<span class="op">(</span>array<span class="op">,</span> third<span class="op">);</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  g_array_append_vals<span class="op">(</span>array<span class="op">,</span> argv<span class="op">,</span> argc<span class="op">);</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  g_array_prepend_val<span class="op">(</span>array<span class="op">,</span> first<span class="op">);</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  g_array_prepend_vals<span class="op">(</span>array<span class="op">,</span> argv<span class="op">,</span> argc<span class="op">);</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  g_array_insert_val<span class="op">(</span>array<span class="op">,</span> <span class="dv">3</span><span class="op">,</span> forth<span class="op">);</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 获取内容 */</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;Array size : </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> array<span class="op">-&gt;</span>len<span class="op">);</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  PRINT_ARRAY_CONTENTS<span class="op">;</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 删除内容 */</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  g_array_remove_index<span class="op">(</span>array<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  g_array_remove_range<span class="op">(</span>array<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  g_array_remove_index_fast<span class="op">(</span>array<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;Array size after remove : </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> array<span class="op">-&gt;</span>len<span class="op">);</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  PRINT_ARRAY_CONTENTS<span class="op">;</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 排序 */</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;After sort:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>  g_array_sort<span class="op">(</span>array<span class="op">,</span> <span class="op">(</span>GCompareFunc<span class="op">)(</span>g_strcmp0<span class="op">));</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  PRINT_ARRAY_CONTENTS<span class="op">;</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 释放 */</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  g_array_free<span class="op">(</span>array<span class="op">,</span> FALSE<span class="op">);</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p>除了基础的 <code>GArray</code>，glib 还提供了 <code>GPtrArray</code> 和 <code>GByteArray</code>:</p>
    <div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glib.h&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  GPtrArray <span class="op">*</span>array <span class="op">=</span> g_ptr_array_new<span class="op">();</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> <span class="op">*</span>buffer <span class="op">=</span> <span class="op">(</span><span class="dt">char</span> <span class="op">*)</span>malloc<span class="op">(</span><span class="dv">1024</span><span class="op">);</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">16</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    sprintf<span class="op">(</span>buffer<span class="op">,</span> <span class="st">&quot;</span><span class="sc">%d</span><span class="st">,</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> i <span class="op">*</span> i<span class="op">);</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    g_ptr_array_add<span class="op">(</span>array<span class="op">,</span> g_strdup<span class="op">(</span>buffer<span class="op">));</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>buffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1024</span><span class="op">);</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  g_ptr_array_foreach<span class="op">(</span>array<span class="op">,</span> <span class="op">(</span>GFunc<span class="op">)</span>printf<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  g_ptr_array_free<span class="op">(</span>array<span class="op">,</span> TRUE<span class="op">);</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  free<span class="op">(</span>buffer<span class="op">);</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <p><code>GByteArray</code> 最适合用来完成对二进制数据的「读取-扩容」循环：</p>
    <div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glib.h&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>GByteArray <span class="op">*</span>read_file_to_byte_array<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>file_path<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  GByteArray <span class="op">*</span>byte_array <span class="op">=</span> g_byte_array_new<span class="op">();</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">FILE</span> <span class="op">*</span>file <span class="op">=</span> fopen<span class="op">(</span>file_path<span class="op">,</span> <span class="st">&quot;rb&quot;</span><span class="op">);</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> buffer<span class="op">[</span><span class="dv">1024</span><span class="op">];</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">size_t</span> bytes_read<span class="op">;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> <span class="op">((</span>bytes_read <span class="op">=</span> fread<span class="op">(</span>buffer<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buffer<span class="op">),</span> file<span class="op">))</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    g_byte_array_append<span class="op">(</span>byte_array<span class="op">,</span> <span class="op">(</span><span class="dt">const</span> guint8 <span class="op">*)</span>buffer<span class="op">,</span> bytes_read<span class="op">);</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  fclose<span class="op">(</span>file<span class="op">);</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> byte_array<span class="op">;</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  GByteArray <span class="op">*</span>byte_array <span class="op">=</span> read_file_to_byte_array<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;Length of file : </span><span class="sc">%ld\n</span><span class="st">&quot;</span><span class="op">,</span> byte_array<span class="op">-&gt;</span>len<span class="op">);</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
    <h2 id="树">树</h2>
    <p>glib 提供两种树：平衡二叉树 <code>GTree</code> 和 n 叉树 <code>GNode</code>。 前者适合于树的每一个节点都只有不超过两个子节点，其内容被有序的存放以便快速搜索和查询。</p>
    <div class="sourceCode" id="cb18"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glib.h&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PRINT_TREE_INFO                               </span><span class="op">\</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="pp">  printf</span><span class="op">(</span><span class="st">&quot;Tree height : </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span><span class="pp"> g_tree_height</span><span class="op">(</span><span class="pp">t</span><span class="op">));</span><span class="pp">     </span><span class="op">\</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="pp">  printf</span><span class="op">(</span><span class="st">&quot;Tree nodes : </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span><span class="pp"> g_tree_nnodes</span><span class="op">(</span><span class="pp">t</span><span class="op">));</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>gboolean iter_all<span class="op">(</span>gpointer key<span class="op">,</span> gpointer value<span class="op">,</span> gpointer data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s</span><span class="st">, </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> key<span class="op">,</span> value<span class="op">);</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> FALSE<span class="op">;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  GTree <span class="op">*</span>t <span class="op">=</span> g_tree_new<span class="op">((</span>GCompareFunc<span class="op">)</span>g_ascii_strcasecmp<span class="op">);</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 增 */</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  g_tree_insert<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;111&quot;</span><span class="op">,</span> <span class="st">&quot;A&quot;</span><span class="op">);</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  g_tree_insert<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;222&quot;</span><span class="op">,</span> <span class="st">&quot;B&quot;</span><span class="op">);</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  g_tree_insert<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;333&quot;</span><span class="op">,</span> <span class="st">&quot;C&quot;</span><span class="op">);</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  PRINT_TREE_INFO<span class="op">;</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 删 */</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  g_tree_remove<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;d&quot;</span><span class="op">);</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  PRINT_TREE_INFO<span class="op">;</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 查 */</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> g_tree_lookup<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;a&quot;</span><span class="op">)</span> <span class="op">?</span> <span class="st">&quot;Found&quot;</span> <span class="op">:</span> <span class="st">&quot;Not found&quot;</span><span class="op">);</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> g_tree_lookup<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;111&quot;</span><span class="op">)</span> <span class="op">?</span> <span class="st">&quot;Found&quot;</span> <span class="op">:</span> <span class="st">&quot;Not found&quot;</span><span class="op">);</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 改 */</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  g_tree_replace<span class="op">(</span>t<span class="op">,</span> <span class="st">&quot;1&quot;</span><span class="op">,</span> <span class="st">&quot;Z&quot;</span><span class="op">);</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 遍历 */</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  g_tree_foreach<span class="op">(</span>t<span class="op">,</span> <span class="op">(</span>GTraverseFunc<span class="op">)</span>iter_all<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  g_tree_destroy<span class="op">(</span>t<span class="op">);</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

    <br />
    
    <h2>参考链接</h2>
    <ul id="reference">
      <li><a href="https://developer.ibm.com/tutorials/l-glib/" target="_blank"><strong>Manage C data using the GLib collections</strong></a></li>
<li><a href="http://www.cse.yorku.ca/~oz/hash.html" target="_blank"><strong>Hash Functions</strong></a></li>
    </ul>
    


    <br />
    <script src="https://giscus.app/client.js" data-repo="izfsk-ium/izfsk-ium.github.io" data-repo-id="R_kgDOJ7Ymyw"
      data-category="Announcements" data-category-id="DIC_kwDOJ7Ymy84CX4eg" data-mapping="title" data-strict="0"
      data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme"
      data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async>
      </script>
  </main>



  <footer>
    <p class="signoff">
    <div class="metadata">
            <p class="date"><time datetime="2023-09-05">创建日期：2023-09-05</time></p>
            <p class="lastmodify"><time>最后编译：2023-09-06</time></p>
      <p class="lastmodify" id="counter-span">访问次数：</p>
    </div>
    </p>
  </footer>

  
  <script>
    /* These script should run after page load */
    document.querySelectorAll('code.sourceCode').forEach(
      i => i.insertAdjacentHTML('beforeend', '<div class="copy">复制</div>')
    );
    document.querySelectorAll('div.copy').forEach(
      i => i.addEventListener(
        'click',
        () => {
          navigator.clipboard.writeText(i.parentElement.innerText.replace('复制', ''));
          i.innerText = '成功';
          setTimeout(() => {
            i.innerText = '复制';
          }, 1000);
        }
      )
    );

    if (location.href.includes("127.0.0.1:8080")) {
      document.getElementById("counter-span").innerHTML = "[[development mode]]";
    } else {
      const uuid = document.getElementById("article-uuid").innerText;
      const target = document.getElementById("counter-span");
      const last = localStorage.getItem("lastVisit-" + uuid);
      const shouldIncrease = last === null || new Date().getTime() - parseInt(last) >= (1000 * 60 * 15);

      fetch(shouldIncrease ? ("https://counter.izfsk.top/counter/" + uuid) : ("https://counter.izfsk.top/readOnly/" + uuid))
        .then(r => r.text())
        .then(d => {
          if (!d.startsWith("Too"))
            document.getElementById("counter-span").innerText = "访问次数：" + d.toString();
          else
            document.getElementById("counter-span").innerHTML = "";
        });

      localStorage.setItem("lastVisit-" + uuid, new Date().getTime());
    }
  </script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.min.js"></script>
  <script async src="https://analytics.umami.is/script.js"
    data-website-id="2a1146ab-fa82-4a84-a04f-30e5967357c3"></script>
</body>

</html>