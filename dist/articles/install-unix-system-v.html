<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="" >

<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
      <meta name="dcterms.date" content="2023-07-22" />
        <title>UNIX System V 的安装和设置</title>
    <link rel="stylesheet" href="/resources/css/article/theme.css" />
    <link rel="stylesheet" href="/resources/css/article/code.css" />
      
  
<style>
@font-face {
  font-family: CONTENT;
  src: url('/resources/fonts/subsets/FTca4147da-03bf-e4cc-3d48-3e7cd2e44295.woff2') format('woff2'),
       url('/resources/fonts/subsets/FTca4147da-03bf-e4cc-3d48-3e7cd2e44295.ttf') format('truetype');
}
</style>


  <script src="/resources/js/article.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.css" />
</head>

<body>
  <progress id="content_progress" value="0"></progress>
  <button id="back-to-top">
    回页顶
  </button>

  
  <header>
    <small style="display: none !important;" id="article-uuid">ca4147da-03bf-e4cc-3d48-3e7cd2e44295</small>
    <h1 class="title">UNIX System V 的安装和设置</h1>
    <!-- Subtitle -->
        <h3 class="subtitle">&nbsp;</h3>
      </header>

    <nav id="TOC" role="doc-toc">
    <strong>文章归类:&nbsp;<a href="/pages/category.html#考古">考古</a> </strong>
    <input type="checkbox" id="contents">
    <ul>
    <li><a href="#主系统" id="toc-主系统">主系统</a></li>
    <li><a href="#安装软件" id="toc-安装软件">安装软件</a></li>
    </ul>
    <ul>
      <li><a href="#reference">参考链接</a></li>
      <li>&nbsp;</li>
      <li class="tools">
        <span id="backtomain">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house"
            viewBox="0 0 16 16">
            <path
              d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z" />
          </svg>
        </span>
        <span id="readingmode">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-book"
            viewBox="0 0 16 16">
            <path
              d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z" />
          </svg>
        </span>
        <span id="larger"> </span>
        <span id="smaller"></span>
        <span id="switchfont">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-fonts"
            viewBox="0 0 16 16">
            <path
              d="M12.258 3h-8.51l-.083 2.46h.479c.26-1.544.758-1.783 2.693-1.845l.424-.013v7.827c0 .663-.144.82-1.3.923v.52h4.082v-.52c-1.162-.103-1.306-.26-1.306-.923V3.602l.431.013c1.934.062 2.434.301 2.693 1.846h.479L12.258 3z" />
          </svg>
        </span>
        <span id="backtotop">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-bar-up"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M8 10a.5.5 0 0 0 .5-.5V3.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 3.707V9.5a.5.5 0 0 0 .5.5zm-7 2.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1-.5-.5z" />
          </svg>
        </span>
      </li>
    </ul>

  </nav>
  
  <main>
    

    <p>最近考古上瘾，这次打算安装一下 UNIX 的老祖：AT&amp;T System V Unix。</p>
    <h2 id="主系统">主系统</h2>
    <p>首先是要<a href="./assets/AT%26T%20UNIX%20System%20V%20Release%204%20Version%202.1%20(3.5).7z">下载安装镜像</a>。这一次下载下来的是若干张 3.5 英寸软盘镜像。安装就从这些软盘镜像开始。创建一个虚拟机，添加 IDE 硬盘以及 I82078 软驱设备，记得不要调过高的 RAM，然后插入启动，软驱中插入 <code>Base 01 (2.1a).img</code>，启动：</p>
    <figure>
    <img src="./assets/panic.png" alt="Panic!" />
    <figcaption aria-hidden="true">Panic!</figcaption>
    </figure>
    <p>然后系统就 Panic 了。原因是所谓的 <a href="http://www.steunebrink.info/bioslim.htm#Contents">504MB限制</a>。</p>
    <p>在很久很久以前，至少回溯到 DOS 时代，那时候为了和磁盘交互，系统需要使用 BIOS 中断。也就是调用 <code>INT 13h</code> 将跳转到计算机 <code>BIOS</code> 代码中进行低级磁盘服务，该代码将为程序执行基于物理扇区的磁盘读取或写入操作。这就使得操作系统不需要处理各个不同硬盘厂商生存的硬盘，只需要和 BIOS 交互即可。早期的 BIOS 可以寻址 1024 个柱面、256 个磁头和 63 个扇区。按照每个扇区 512 bytes 计算，这也就意味着 512 × (1024 × 256 × 63) = 8455716864 bytes 可以达到 8 GB。这也是理论上的最大限制。</p>
    <p>很快，为了满足人民群众对更大硬盘的向往，IBM 和 Western Digital 又发明了另外一套接口，也就是 (IDE/AT) HD Interface，理论上相当不错：65535 个柱面、16 个磁头和 256 个扇区，乘起来就是 65535 × 16 × 256 × 512 = 137436856320 bytes 相当于约 127.5 GB。</p>
    <p>然而问题在于：<strong>这两套系统并不相互兼容</strong>，孤独的天才们独立创作，丝毫没有和同行们沟通。为了让两个系统可以合作，只能对使用每个规格中最小的进行寻址！也就是说：</p>
    <p>16 柱面 x 1024 磁头 x 63 扇区 x 512 bytes 每个扇区 = 528,482,304 Bytes = 504 MB</p>
    <p>所以为了安装能够继续下去，最方便的方法就是新建一个新的 VDI，设置大小为 503 MB。</p>
    <figure>
    <img src="./assets/installsysv.png" alt="安装过程" />
    <figcaption aria-hidden="true">安装过程</figcaption>
    </figure>
    <p>接下来的工作很无聊：按照屏幕上的提示，格式化硬盘，重启，然后挨个把对应的软盘放进去安装。</p>
    <figure>
    <img src="./assets/installsysv2.png" alt="插入一系列软盘" />
    <figcaption aria-hidden="true">插入一系列软盘</figcaption>
    </figure>
    <p>然后是设置密码，主机名等等。</p>
    <figure>
    <img src="./assets/setpassword.png" alt="设置密码" />
    <figcaption aria-hidden="true">设置密码</figcaption>
    </figure>
    <p>重启，大功告成。</p>
    <figure>
    <img src="./assets/installsysvdone.png" alt="安装完毕" />
    <figcaption aria-hidden="true">安装完毕</figcaption>
    </figure>
    <h2 id="安装软件">安装软件</h2>
    <p>这是一个很「干净的系统」，<code>/usr/bin</code> 目录下只有 255 个程序，相比之下我的电脑上有 2950 个之多。当然，这玩意也是有包管理器的，只不过并没有网络功能，需要依靠软盘安装。键入 <code>pkgadd -d diskette1</code> 再按照提示将包含软件包的磁碟放入即可安装。</p>
    <figure>
    <img src="./assets/systemvinstallpackages.png" alt="安装软件包" />
    <figcaption aria-hidden="true">安装软件包</figcaption>
    </figure>
    <p>安装完毕后重启，<strong>如果卡在第一屏一动不动，只有光标闪烁，说明忘记把软件安装软盘弹出软驱。</strong>。</p>
    <p>但是这些软件包中并没有 C 编译器套件。你可以在<a href="http://www.bitsavers.org/bits/ATT/SYSV_386/SYSV_Rel_4.0_Ver_1.0_386_486_partial.zip">这里</a>下载它们。其中包括的 <code>Standard_C_Development_Environment_R5.0</code> 就是 C 开发环境。</p>
    <figure>
    <img src="./assets/Standard_C_Development_Environment_R5.0.webp" alt="安装软盘封面" />
    <figcaption aria-hidden="true">安装软盘封面</figcaption>
    </figure>
    <p>接下来需要做的是把 IMD 镜像转换成 IMG 格式。有一个工具 <a href="https://github.com/keirf/Disk-Utilities">disk-utilities</a> 可以做到这一点。克隆仓库并编译之。然后使用 <code>disk-analyse input.IMD output.img</code> 即可。如果遇到 <code>error while loading shared libraries: libdisk.so.0</code>，更新 LD_PATH 为 <code>LD_LIBRARY_PATH=libdisk disk-analyse/disk-analyse</code> 即可。方便起见，将转换完毕的文件放在<a href="./assets/Standard_C_Development_Environment_R5.0.7z">这里</a>。插入安装：</p>
    <figure>
    <img src="./assets/install_sdce.png" alt="安装 SDCE" />
    <figcaption aria-hidden="true">安装 SDCE</figcaption>
    </figure>
    <p>安装完毕后，使用 vi 编辑器创建源文件并编译成功。</p>
    <figure>
    <img src="./assets/hellosysvunix.png" alt="编译" />
    <figcaption aria-hidden="true">编译</figcaption>
    </figure>

    <br />
    
    <h2>参考链接</h2>
    <ul id="reference">
      <li><a href="https://winworldpc.com/product/att-system-v-unix/2-x" target="_blank"><strong>AT&T System V Unix 2.x</strong></a></li>
<li><a href="http://www.steunebrink.info/bioslim.htm#Contents" target="_blank"><strong>The BIOS IDE Harddisk Limitations</strong></a></li>
<li><a href="https://en.wikipedia.org/wiki/INT_13H" target="_blank"><strong>INT 13H</strong></a></li>
<li><a href="https://www.linuxquestions.org/questions/other-*nix-55/using-floppies-in-at-and-t-unix-system-v-release-4-version-2-1-or-docs-link-4175428440/" target="_blank"><strong>Using floppies in AT&T UNIX System V</strong></a></li>
<li><a href="https://retrocomputing.stackexchange.com/questions/7890/how-can-i-use-imagedisk-imd-images-with-virtualbox-winimage-etc" target="_blank"><strong>How can I use ImageDiskimages with VirtualBox?</strong></a></li>
<li><a href="https://github.com/keirf/Disk-Utilities" target="_blank"><strong>keirf / disk-utilities</strong></a></li>
<li><a href="https://www.admin.com/samples/UUCP.pdf" target="_blank"><strong>About UUCP</strong></a></li>
    </ul>
    


    <br />
    <script src="https://giscus.app/client.js" data-repo="izfsk-ium/izfsk-ium.github.io" data-repo-id="R_kgDOJ7Ymyw"
      data-category="Announcements" data-category-id="DIC_kwDOJ7Ymy84CX4eg" data-mapping="title" data-strict="0"
      data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme"
      data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async>
      </script>
  </main>



  <footer>
    <p class="signoff">
    <div class="metadata">
            <p class="date"><time datetime="2023-07-22">创建日期：2023-07-22</time></p>
            <p class="lastmodify"><time>最后编译：2023-08-07</time></p>
      <p class="lastmodify" id="counter-span">访问次数：</p>
    </div>
    </p>
  </footer>

  
  <style>
    #back-to-top {
      position: fixed;
      bottom: 25px;
      right: 20px;
      display: none;
      border-radius: 0;
      padding: 3px;
      background: var(--background-color);
      border-color: gray;
      z-index: 999;
      color: var(--color-text);
    }
  </style>
  <script>
    window.addEventListener('scroll', function () {
      var button = document.getElementById('back-to-top');
      if (window.pageYOffset > 125) {
        button.style.display = 'block';
      } else {
        button.style.display = 'none';
      }
    });

    document.getElementById('back-to-top').addEventListener('click', function () {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    if (location.href.includes("127.0.0.1:8080")) {
      document.getElementById("counter-span").innerHTML = "development mode. ignore counter request.";
    } else {
      const uuid = document.getElementById("article-uuid").innerText;
      fetch("https://counter.izfsk.top/counter/" + uuid)
        .then(r => r.text())
        .then(d => {
          if (!d.startsWith("Too"))
            document.getElementById("counter-span").innerText = "访问次数：" + d.toString();
          else
            document.getElementById("counter-span").innerHTML = "";
        })
        .catch(e => console.warn(e));
    }

  </script>
  <script async src="https://analytics.umami.is/script.js"
    data-website-id="2a1146ab-fa82-4a84-a04f-30e5967357c3"></script>
</body>

</html>