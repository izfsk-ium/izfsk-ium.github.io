<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="" >

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="keywords" content='blog, izfsk-ium, izfsk, 博客'>

  <meta name=author content=izfsk>
  <meta property=og:site_name content="白漠流霜">
  <meta name="twitter:title" content="博客迁移从域名到部署">
  <meta property=og:title content="博客迁移从域名到部署">
  <meta itemprop=name content="博客迁移从域名到部署">
  <meta name="keywords" content='blog, izfsk-ium, izfsk, 博客'>
  <meta property='og:type' content='website'>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="izfsk" />

    <meta name="dcterms.date" content="2023-02-26" />
        <title>博客迁移从域名到部署</title>
    <link rel="stylesheet" href="/resources/css/article/theme.css" />
    <link rel="stylesheet" href="/resources/css/article/code.css" />
      
  
<style>
@font-face {
  font-family: CONTENT;
  src: url('/resources/fonts/subsets/FT3dcffc06-560d-4ab2-9c64-62cf2b24682a.woff2') format('woff2'),
       url('/resources/fonts/subsets/FT3dcffc06-560d-4ab2-9c64-62cf2b24682a.ttf') format('truetype');
}
</style>


  <script src="/resources/js/article.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.css" />
</head>

<body>
  <progress id="content_progress" value="0"></progress>

  
  <header>
    <small style="display: none !important;" id="article-uuid">3dcffc06-560d-4ab2-9c64-62cf2b24682a</small>
    <h1 class="title">博客迁移从域名到部署</h1>
    <!-- Subtitle -->
        <h3 class="subtitle">&nbsp;</h3>
      </header>

    <nav id="TOC" role="doc-toc">
    <li class="tools">
      <span id="togglesidebar">
        <b>隐藏</b>
      </span>
      <span id="readingmode">
        <b>列印</b>
      </span>
      <span id="switchfont">
        <b>字体</b>
      </span>
      <span id="backtotop">
        <b>页顶</b>
      </span>
    </li>
    <strong>文章归类:&nbsp;<a href="/pages/category.html#杂项">杂项</a> </strong>
    <input type="checkbox" id="contents">
    <ul>
    <li><a href="#域名的选择和购买" id="toc-域名的选择和购买">域名的选择和购买</a></li>
    <li><a href="#render" id="toc-render">Render</a></li>
    <li><a href="#cloudflare" id="toc-cloudflare">Cloudflare</a></li>
    </ul>
    <ul>
      <li><a href="#reference">参考链接</a></li>
    </ul>

  </nav>
  
  <main>
    

    <p>本站进行了一次迁徙，其实也不能说是完全的「迁徙」，但不管怎么样，现在可以使用自己的域名，而不是托管使用 github.io 的子域名了。除此以外，部署方式也作了修改，不再使用中国境内访问慢吞吞的 Github Pages 而采用 render.com 提供的部署服务，同时也套上了 Cloudflare。总之，除了域名费用以外并没有花其他的钱。这篇文章记录一下整个的流程。</p>
    <h1 id="域名的选择和购买">域名的选择和购买</h1>
    <p><strong>购买域名的第一注意事项：不要使用中国的域名注册商家或者购买由中国的公司/组织管理的顶级域名</strong>。这样做纯粹是为了避免麻烦，主要是不可预期的政策风险和及其复杂的备案流程。即使你像我一样只是一个遵纪守法的好公民，这一整套流程下来，钱和精力都要耗费不少。具体的来讲，首先不要购买 <code>.cn</code> 的域名，其次不要选择中文域名，最后，在其他域名之间选择时，记得先去 <a href="https://icannwiki.org/">ICANN Wiki</a> 查询一下你要购买的顶级域名的管理者到底是何方神圣，省得后悔。比如，本站的新域名的顶级域名 <a href="https://icannwiki.org/Top_Registry"><code>.top</code></a> 就是一家江苏省的公司管理的，这也是我购买以后才发现，真是后悔不迭。</p>
    <p>其次，要注意「第一年价格」和「续费价格」，有的域名第一年很便宜，但之后续费就飙升到几十乃至上百美元，另外还需要注意各种附加服务，提防不小心选择到自己不需要的东西。</p>
    <p>我选择的域名注册商家是 <a href="http://namesilo.com">Namesilo</a>，主要原因是它支持支付宝支付。选择和购买很简单顺畅，毕竟没有一个商家会在用户付款的路上添堵。然而，相比于它现代的选择购买界面：</p>
    <p><img src="./assets/main.png" /></p>
    <p>它的后台管理界面似乎让你回到了 15 年前：</p>
    <p><img src="./assets/bad.png" /></p>
    <p>以至于我第一次进入时以为自己被什么野鸡商家骗了钱（</p>
    <p>接下来在右边第二个「Domain Manager」里面确认你的域名即可。</p>
    <p><img src="./assets/div.png" /></p>
    <h1 id="render">Render</h1>
    <p>Github Pages 其实已经很好了，但是由于众所周知的原因，中国境内访问它时不时会被阻断和劣化。所以需要另外一个部署服务来「加速」。有不少教程推荐使用 Netlify，但是它很荣幸的在我所在的区域被 reset 了。所以我选择其他替代方案。</p>
    <p>其实这些服务，Netlify 也好，Render 也好，对于我这样的用户来讲都是大同小异的。我用不到复杂的功能，只是作为一个静态站点同步和部署来用。</p>
    <p>直接在<a href="https://dashboard.render.com/register">这里</a>注册登录，如果使用 Github 登录，可以直接快捷的绑定 repo。选择创建一个新的 Static Site，然后点击右侧的 「Configure account 」绑定 Github 帐号里面的相应 repo 点击 Connect 即可。</p>
    <p><img src="./assets/start.png" /></p>
    <p>然后就是配置。你需要起一个名字，它同样是一个二级域名：<code>*.onrender.com</code>。不过既然接下来要自定义域名这个也无关紧要。我的站点是完全本地生成后 push 到仓库的，所以没有 Build Command，Publish directory 则是根目录 <code>./</code>。<strong>默认情况下每一次对源 repo 的 push 都会触发一次更新</strong>，不需要手动设置。</p>
    <p><img src="./assets/cfgs.png" /></p>
    <p>接下来是等待部署。等到部署完成后，就可以访问了。同时，状态变成这样：</p>
    <p><img src="./assets/oks.png" /></p>
    <p>此时可以访问 <code>name.onrender.com</code> 访问了。这种情况下它相当于是一个类似 Github Pages 但是略微加速。</p>
    <h1 id="cloudflare">Cloudflare</h1>
    <p>使用它不仅仅是出于防止 DDOS 或者的考虑，<del>毕竟 CDN 能减速。</del>其实这反而是次要的考虑。要使用 Cloudflare ，首先需要把域名的 nameserver 转移到 Cloudflare 那边去。Cloudflare 注册以后会有一个向导，一步一步来就行了。主要是 namesilo 那边。你需要先勾选复选框，再点击：</p>
    <p><img src="./assets/div2.png" /></p>
    <p>然后把原来的删除，添加 Cloudflare 给你的：</p>
    <p><img src="./assets/ns.png" /></p>
    <p>接下来是 CF 这边，DNS 缓存的全球更新需要一点时间，所以需要等一会儿。接下来就是设置解析地址，点到你的域名，DNS 设置里面添加。DNS 记录可以理解成一个 K-V 对，主要需要知道的三种记录类型：</p>
    <ul>
    <li>A : 域名 -&gt; IPv4 地址</li>
    <li>AAAA : 域名 -&gt; IPv6 地址</li>
    <li>CNAME : 域名 -&gt; 另外一个域名</li>
    </ul>
    <p>添加好相应的域名即可。注意在导入站点的时候，会发现有几条不认识的 A 记录，那是 Namesilo 的广告页面，删掉就行。添加 <code>A</code> 记录可以使用中国境内的 VPS 地址也可以正常访问，但是<strong>有合规性风险</strong>，不建议尝试。「要么全是(中国)境外，要么全是(中国)境内」，不要混着来。</p>
    <p><img src="./assets/name.png" /></p>
    <p>所以，访问 <code>blog.izfsk.top</code> 就会相应的跳转到 <code>izfsk.onrender.com</code> 那边去。但是，此时还是不能够正常使用，因为 Render 那边的 <code>Custom Domains</code> 还没有设置。回到 Render 的 Dashboard 里面找到你的项目，在 Settings 里面，添加自定义的域名即可。需要等待一会儿 DNS 刷新以及 Render 处理证书。最后的状态是这样的：</p>
    <p><img src="./assets/ok.png" /></p>
    <p>那么就大功告成啦！</p>
    <p>其实 Render 还支持免费(有大小和时间限制的) PostgreSQL 服务和 Web Service 服务，完全可以折腾一下搞一个评论功能，把白嫖进行到底（</p>

    <br />
    <!--%%REF%%-->


    <br />
    <script src="https://giscus.app/client.js" data-repo="izfsk-ium/izfsk-ium.github.io" data-repo-id="R_kgDOJ7Ymyw"
      data-category="Announcements" data-category-id="DIC_kwDOJ7Ymy84CX4eg" data-mapping="title" data-strict="0"
      data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme"
      data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async>
      </script>
  </main>



  <footer>
    <p class="signoff">
    <div class="metadata">
            <p class="date"><time datetime="2023-02-26">创建日期：2023-02-26</time></p>
            <p class="lastmodify"><time>最后编译：2023-08-13</time></p>
      <p class="lastmodify" id="counter-span">访问次数：</p>
    </div>
    </p>
  </footer>

  
  <script>
    /* These script should run after page load */
    document.querySelectorAll('code.sourceCode').forEach(
      i => i.insertAdjacentHTML('beforeend', '<div class="copy">复制</div>')
    );
    document.querySelectorAll('div.copy').forEach(
      i => i.addEventListener(
        'click',
        () => {
          navigator.clipboard.writeText(i.parentElement.innerText.replace('复制', ''));
          i.innerText = '成功';
          setTimeout(() => {
            i.innerText = '复制';
          }, 1000);
        }
      )
    );

    if (location.href.includes("127.0.0.1:8080")) {
      document.getElementById("counter-span").innerHTML = "[[development mode]]";
    } else {
      const uuid = document.getElementById("article-uuid").innerText;
      const target = document.getElementById("counter-span");
      const last = localStorage.getItem("lastVisit-" + uuid);
      const shouldIncrease = last === null || new Date().getTime() - parseInt(last) >= (1000 * 60 * 15);

      fetch(shouldIncrease ? ("https://counter.izfsk.top/counter/" + uuid) : ("https://counter.izfsk.top/readOnly/" + uuid))
        .then(r => r.text())
        .then(d => {
          if (!d.startsWith("Too"))
            document.getElementById("counter-span").innerText = "访问次数：" + d.toString();
          else
            document.getElementById("counter-span").innerHTML = "";
        });

      localStorage.setItem("lastVisit-" + uuid, new Date().getTime());
    }
  </script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.min.js"></script>
  <script async src="https://analytics.umami.is/script.js"
    data-website-id="2a1146ab-fa82-4a84-a04f-30e5967357c3"></script>
</body>

</html>