<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="" >

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

      <meta name="dcterms.date" content="2022-07-13" />
        <title>Lenovo Legion R7000 安装 openSUSE</title>
    <link rel="stylesheet" href="/resources/css/article/theme.css" />
    <link rel="stylesheet" href="/resources/css/article/code.css" />
      
  
<style>
@font-face {
  font-family: CONTENT;
  src: url('/resources/fonts/subsets/FT27229a58-7f89-47b6-b217-54f35d638fb1.woff2') format('woff2'),
       url('/resources/fonts/subsets/FT27229a58-7f89-47b6-b217-54f35d638fb1.ttf') format('truetype');
}
</style>


  <script src="/resources/js/article.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.css" />
</head>

<body>
  <progress id="content_progress" value="0"></progress>
  <button id="back-to-top">
    回页顶
  </button>

  
  <header>
    <small style="display: none !important;" id="article-uuid">27229a58-7f89-47b6-b217-54f35d638fb1</small>
    <h1 class="title">Lenovo Legion R7000 安装 openSUSE</h1>
    <!-- Subtitle -->
        <h3 class="subtitle">&nbsp;</h3>
      </header>

    <nav id="TOC" role="doc-toc">
    <strong>文章归类:&nbsp;<a href="/pages/category.html#杂项">杂项</a> </strong>
    <input type="checkbox" id="contents">
    <ul>
    <li><a href="#lenovo-legion-r7000-2021-opensuse-i3wm-配置" id="toc-lenovo-legion-r7000-2021-opensuse-i3wm-配置">Lenovo Legion R7000 2021 + openSUSE + i3wm 配置</a>
    <ul>
    <li><a href="#操作系统安装" id="toc-操作系统安装">1. 操作系统安装</a></li>
    <li><a href="#nvidia驱动安装" id="toc-nvidia驱动安装">2. Nvidia驱动安装</a></li>
    <li><a href="#窗口管理器安装" id="toc-窗口管理器安装">3. 窗口管理器安装</a></li>
    <li><a href="#多媒体解码器安装" id="toc-多媒体解码器安装">4. 多媒体解码器安装</a></li>
    <li><a href="#下拉终端" id="toc-下拉终端">5. 下拉终端</a></li>
    <li><a href="#终端模拟器" id="toc-终端模拟器">6. 终端模拟器</a></li>
    <li><a href="#壁纸" id="toc-壁纸">7. 壁纸</a></li>
    <li><a href="#状态栏" id="toc-状态栏">8. 状态栏</a></li>
    <li><a href="#混成器" id="toc-混成器">9. 混成器</a></li>
    <li><a href="#网络管理" id="toc-网络管理">10. 网络管理</a></li>
    <li><a href="#输入法" id="toc-输入法">11. 输入法</a></li>
    <li><a href="#锁屏" id="toc-锁屏">12. 锁屏</a></li>
    <li><a href="#背光调节" id="toc-背光调节">13. 背光调节</a></li>
    <li><a href="#通知管理" id="toc-通知管理">14. 通知管理</a></li>
    <li><a href="#u盘自动挂载" id="toc-u盘自动挂载">15. U盘自动挂载</a></li>
    </ul></li>
    </ul>
    <ul>
      <li><a href="#reference">参考链接</a></li>
      <li>&nbsp;</li>
      <li class="tools">
        <span id="backtomain">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house"
            viewBox="0 0 16 16">
            <path
              d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z" />
          </svg>
        </span>
        <span id="readingmode">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-book"
            viewBox="0 0 16 16">
            <path
              d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z" />
          </svg>
        </span>
        <span id="larger"> </span>
        <span id="smaller"></span>
        <span id="switchfont">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-fonts"
            viewBox="0 0 16 16">
            <path
              d="M12.258 3h-8.51l-.083 2.46h.479c.26-1.544.758-1.783 2.693-1.845l.424-.013v7.827c0 .663-.144.82-1.3.923v.52h4.082v-.52c-1.162-.103-1.306-.26-1.306-.923V3.602l.431.013c1.934.062 2.434.301 2.693 1.846h.479L12.258 3z" />
          </svg>
        </span>
        <span id="backtotop">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-bar-up"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M8 10a.5.5 0 0 0 .5-.5V3.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 3.707V9.5a.5.5 0 0 0 .5.5zm-7 2.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1-.5-.5z" />
          </svg>
        </span>
      </li>
    </ul>

  </nav>
  
  <main>
    

    <h1 id="lenovo-legion-r7000-2021-opensuse-i3wm-配置">Lenovo Legion R7000 2021 + openSUSE + i3wm 配置</h1>
    <ol type="1">
    <li><p>不要使用openSUSE Leap，目前的Leap(15.3)无法识别无线网卡驱动。Tumbleweed可以识别。</p></li>
    <li><p>在BIOS设置里将输出设置从”集显输出”改为”混合输出”，否则在suspend后无法苏醒。</p></li>
    <li><p>如果使用KDE，避免使用Wayland模式，否则CPU占用会暴涨导致无法使用。</p></li>
    </ol>
    <h2 id="操作系统安装">1. 操作系统安装</h2>
    <p>我原本使用的是KDE Neon系统，它在我的老电脑上运作的很好，但我打算在新的电脑上使用非基于Ubuntu和dpkg的系统。Arch太复杂了，最后选择了openSUSE。</p>
    <p>openSUSE有Leap和Tumbleweed两个分发，由于滚动更新曾经搞坏过我的系统，我首先选择了Leap。但是安装出现了两个问题：</p>
    <ul>
    <li><p>无线网卡没法显示出来。安装以后也识别不出来。可能是因为Leap的内核版本太老了。</p></li>
    <li><p>Xorg无法正常启动。虽然我安装的时候选择的默认启动模式是图像界面，但进去还是tty，并且没法<code>startx</code>启动Xorg。不知道是什么问题。</p></li>
    </ul>
    <p>所以我最后安装了Tumbleweed。滚动更新那就两个星期滚一次。而且之后我了解到SUSE使用的btrfs有快照功能，就不用怕滚坏掉系统了。</p>
    <p>安装的过程很顺利，Tumbleweed可以识别所以的硬件，并且安装以后(保险起见我还是安装了KDE全家桶)也可以正常的启动。</p>
    <h2 id="nvidia驱动安装">2. Nvidia驱动安装</h2>
    <p>这台电脑用的是RTX 3050显卡，我不懂这些型号而且也不玩游戏。不过有一个超棒的显卡似乎也不错，那我就觉得要安装一下Nvidia的私有驱动。我按照指南上的成功安装了。</p>
    <pre class="shell"><code>sudo zypper addrepo --refresh https://download.nvidia.com/opensuse/tumbleweed NVIDIA
sudo zypper in x11-video-nvidiaG05</code></pre>
    <p>不过注意安装要在tty模式进行不然可能会出现什么幺蛾子(</p>
    <p>安装完毕以后就可以打开<code>nvidia-settings</code>调控显卡啦！</p>
    <h2 id="窗口管理器安装">3. 窗口管理器安装</h2>
    <p>我以前一直使用KDE全家桶，不过一来我想尝尝鲜，二来买这台电脑没有送我鼠标，最重要的是这个电脑左右两侧的USB口只有一个，导致我根本不够用，所以我打算使用平铺式窗口管理器。</p>
    <p>我参考了一些最后选择使用i3-gap，因为它不只是只有平铺一种模式，也可以切换为浮动模式，这样要是我愿意也可以换回去。而且比起原版的i3，它多一个gap，所以不同的窗口之间可以有空隙，更加好看！软件源里面就有i3-gap所以只需要</p>
    <div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> zypper install i3-gap </span></code></pre></div>
    <p>就可以了。然后众所周知平铺式窗口管理器强烈依赖于键盘(好在Fn+Space切换键盘灯依旧可以用)，所以需要大量的配置。我把大量的快捷键重新map了一遍，<del> 这样其他人就没法用我的电脑啦！</del> 这其实蛮困难的因为总是有好多矛盾的键。我使用了Mod1(Alt)和$Mod(Super)这两个功能键。我打算以后配置完整了上传github备份一下免得丢了。</p>
    <h2 id="多媒体解码器安装">4. 多媒体解码器安装</h2>
    <p>openSUSE没法直接播放mp3之类的格式，据说是因为版权原因巴拉巴拉的什么，总之，要想正常播放多媒体，直接安装vlc肯定是不行啦。所以需要一个叫做<code>packman</code>的第三方源来安装<del>甩锅</del>这些解码器。具体的来讲就是：</p>
    <div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> zypper ar <span class="at">-cfp</span> 90 https://ftp.gwdg.de/pub/linux/misc/packman/suse/openSUSE_Tumbleweed packman</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> zypper dup <span class="at">--from</span> packman <span class="at">--allow-vendor-change</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> zypper install <span class="at">--from</span> packman ffmpeg mpv libavcodec-full vlc-codecs</span></code></pre></div>
    <p>三条指令执行下来就可以播放电影和音乐啦！</p>
    <h2 id="下拉终端">5. 下拉终端</h2>
    <p>这个对我来说很重要，就像对一个人讲话一样，时不时对电脑讲一两句，专门打开一个shell再关掉就太麻烦了。所以需要下拉终端。</p>
    <p>我考虑了我以前使用的KDE的<code>Yakuake</code>，但是它有一些问题，首先是没法正确的混成。导致只有一半的窗口被渲染；其次是它没法正确的被对待为一个”下拉窗口”，总是被i3当作普通的窗口，一下子就占满整个屏幕；最后kde系列软件需要的软件包好多啊。所以我选择了另外一个下拉终端<code>guake</code>，虽然我真的很不喜欢它的名字”挂科”……</p>
    <h2 id="终端模拟器">6. 终端模拟器</h2>
    <p>默认的终端模拟器(就是$mod+Shift+Enter启动的那个)是很丑很丑的<code>uxterm</code>。虽然配置一下也可以很好看，但是我决定使用其他的模拟器。我选择了<code>alacritty</code>。本来是想用<code>kitty</code>的，但是它对于中文输入法似乎支持不够友好，所以即使有很多好功能，比如标签页功能(可以用<code>termux</code>替代)，也没有选择它。</p>
    <h2 id="壁纸">7. 壁纸</h2>
    <p>壁纸当然是使用<code>feh</code>来设置。我本来想使用<code>mpv</code>搞一个动态的视频壁纸，但好像和混成器起了冲突。</p>
    <div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">feh</span> <span class="at">--bg-scale</span> wallpaper_file.jpg</span></code></pre></div>
    <p>记得加在i3的配置文件里面自启动。</p>
    <h2 id="状态栏">8. 状态栏</h2>
    <p>当然是使用<code>polybar</code>啦！我在github上下载了著名的<code>adi1090x/polybar-themes</code>里面的主题。不过要注意，里面的东西<strong>不能直接用</strong>而是要按照自己电脑的实际情况改动。比如里面关于显示wifi状态的网络接口名称每一台电脑都不一样，又比如显卡的亮度读取amd和intel也不一样。</p>
    <p>这些东西，包括栏的显示的内容都可以直接改它的主题文件。具体的就是<code>~/.config/polybar/主题名字/config.ini</code>里面的<code>modules-left</code>,<code>modules-center</code>和<code>modules-right</code>这些内容。可用的模块可以在同目录里面的<code>modules.ini</code>和<code>user_modules.ini</code>    里面找到和更改。最后启动<code>polybar</code>只需要在i3 config里面exec 主题文件夹里面的<code>launch.sh</code>就可以了。</p>
    <p>另外，原版的<code>i3-status</code>也可以保留。我是默认隐藏，只有按特殊键才会显示。里面的内容是一些诸如IP地址之类的不常用的信息。</p>
    <h2 id="混成器">9. 混成器</h2>
    <p>混成器我使用的是<code>picom</code>，还有一个<code>compton</code>可以选择，但是两个软件似乎是矛盾的，安装一个就会自动卸载另外一个。不管怎么说其实都很好啦！</p>
    <p>不管需要注意的是，zypper安装的<code>picom</code>只有<code>kernel</code>这一个模糊方式，如果需要其他的实验性模糊后端必须自己编译github上的源码。</p>
    <h2 id="网络管理">10. 网络管理</h2>
    <del>
    其实也不是是不能用<code>nmtui</code>
    </del>
    <p>使用<code>nm-applet</code>就解决了。</p>
    <p>但还是有问题：总是扫描不出wifi网络。不知道是驱动的问题还是<code>NetworkManager</code>的问题了。总之思考一下以后我使用另外一个方法上网，使用手机的USB tethering功能，即插即用完全不用密码什么的。</p>
    <h2 id="输入法">11. 输入法</h2>
    <p>如果在安装时候选择中文，或者安装以后在yast2里面更改语言为中文，那么中文输入法，词库，字体都会一股脑自动安装上来直接就可以使用，但是，一旦把语言改回英文，yast2就会自作聪明的把这一切都删光光……</p>
    <p>所以，最好的方法就是自己手动安装一下了。我安装的是<code>ibus</code>和<code>rime</code>输入法。</p>
    <div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> zypper install ibus ibus-rime</span></code></pre></div>
    <p>安装成功以后，还需要在<code>ibus-setup</code>里面启用安装的输入法才可以使用。最后不要忘记把守护进程添加到i3的自启动里面。</p>
    <div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">exec-always</span> <span class="at">--no-startup-id</span> ibus-daemon <span class="at">-drx</span></span></code></pre></div>
    <h2 id="锁屏">12. 锁屏</h2>
    <p>锁屏是很必要的。然而i3lock实在是太简陋了，所以有很多加强版的快捷锁屏。</p>
    <ul>
    <li><p><strong>i3lock-fancy</strong></p>
    <p>仓库地址是 https://github.com/meskarune/i3lock-fancy.git</p>
    <p>这其实是一个shell脚本，用来调用原来的i3lock，可以设置截图背景模糊灰度之类的。其实和自己写一个脚本调用convert和scort差不多但是别人写的更方便通用一些。</p></li>
    <li><p><strong>i3lock-color</strong></p>
    <p>仓库地址是 https://github.com/Raymo111/i3lock-color</p>
    <p>这个是fork的原来的i3lock并且加入了许多高级功能，比如可以更改显示位置，显示时间日期什么的。需要自己编译，或者也可以直接下载release。在仓库里面<code>example</code>目录里面有demo脚本可以自己改。</p></li>
    <li><p>xsecurelock</p>
    <p>这个和i3lock没有关系，是谷歌的独立项目。好处在于首先是安全，其次是可以使用mpv作为后端来搞动态锁屏。需要自己编译。</p></li>
    </ul>
    <h2 id="背光调节">13. 背光调节</h2>
    <del>
    我看网上的i3背光调节都是使用<code>xbacklight</code>但是我的完全不起作用，所以我自己用<code>xrandr</code>写了一个脚本绑定快捷键，聊胜于无吧.
    </del>
    <p><code>xbacklight</code> 不起作用的原因：</p>
    <p><strong><code>xbacklight</code> only works with Intel. Other drivers (e.g. Radeon) did not add support for the RandR backlight property.</strong></p>
    <div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="va">B_FILE</span><span class="op">=</span>~/Ramdisk/backlight</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="va">$B_FILE</span> <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&#39;No backlight file found.&#39;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&#39;1.0&#39;</span> <span class="op">&gt;</span> <span class="va">$B_FILE</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="va">old_light</span><span class="op">=</span><span class="va">$(</span><span class="fu">cat</span> ~/Ramdisk/backlight<span class="va">)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$1</span> <span class="ot">==</span> inc <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">new_light</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="va">$old_light</span> <span class="st">&#39;+0.1&#39;</span> <span class="kw">|</span> <span class="fu">bc</span> <span class="va">)</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">new_light</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="va">$old_light</span> <span class="st">&#39;-0.1&#39;</span> <span class="kw">|</span> <span class="fu">bc</span> <span class="va">)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="ex">xrandr</span> <span class="at">--output</span> eDP <span class="at">--brightness</span> <span class="va">$new_light</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$new_light</span> <span class="op">&gt;</span> <span class="va">$B_FILE</span></span></code></pre></div>
    <h2 id="通知管理">14. 通知管理</h2>
    <p>其实通知并不是很多。所以简单地使用dunst再抄一份官网上的配置文件就足够了。</p>
    <h2 id="u盘自动挂载">15. U盘自动挂载</h2>
    <p>相比与完整的桌面环境，i3好像没有可以自动挂载的机制，所以需要手动操作。但是每次sudo mount实在是太麻烦，我找了一下，可以使用<code>udiskie</code>来自动操作。那就下载一个好了。</p>
    <p>缺点在于，现在i3的自启动daemon有六七个之多……</p>

    <br />
    <!--%%REF%%-->


    <br />
    <script src="https://giscus.app/client.js" data-repo="izfsk-ium/izfsk-ium.github.io" data-repo-id="R_kgDOJ7Ymyw"
      data-category="Announcements" data-category-id="DIC_kwDOJ7Ymy84CX4eg" data-mapping="title" data-strict="0"
      data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme"
      data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async>
      </script>
  </main>



  <footer>
    <p class="signoff">
    <div class="metadata">
            <p class="date"><time datetime="2022-07-13">创建日期：2022-07-13</time></p>
            <p class="lastmodify"><time>最后编译：2023-08-10</time></p>
      <p class="lastmodify" id="counter-span">访问次数：</p>
    </div>
    </p>
  </footer>

  
  <script>
    /* These script should run after page load */
    document.querySelectorAll('code.sourceCode').forEach(
      i => i.insertAdjacentHTML('beforeend', '<div class="copy">复制</div>')
    );
    document.querySelectorAll('div.copy').forEach(
      i => i.addEventListener(
        'click',
        () => {
          navigator.clipboard.writeText(i.parentElement.innerText.replace('复制', ''));
          i.innerText = '成功';
          setTimeout(() => {
            i.innerText = '复制';
          }, 1000);
        }
      )
    );

    if (location.href.includes("127.0.0.1:8080")) {
      document.getElementById("counter-span").innerHTML = "[[development mode]]";
    } else {
      const uuid = document.getElementById("article-uuid").innerText;
      const target = document.getElementById("counter-span");
      const last = localStorage.getItem("lastVisit-" + uuid);
      const shouldIncrease = last === null || new Date().getTime() - parseInt(last) >= (1000 * 60 * 15);

      fetch(shouldIncrease ? ("https://counter.izfsk.top/counter/" + uuid) : ("https://counter.izfsk.top/readOnly/" + uuid))
        .then(r => r.text())
        .then(d => {
          if (!d.startsWith("Too"))
            document.getElementById("counter-span").innerText = "访问次数：" + d.toString();
          else
            document.getElementById("counter-span").innerHTML = "";
        });

      localStorage.setItem("lastVisit-" + uuid, new Date().getTime());
    }
  </script>
  <script async src="https://analytics.umami.is/script.js"
    data-website-id="2a1146ab-fa82-4a84-a04f-30e5967357c3"></script>
</body>

</html>